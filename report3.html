<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.24">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Loan Bianchi">
<meta name="dcterms.date" content="2025-10-04">

<title>MATH-517: Assignment 3</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="report3_files/libs/clipboard/clipboard.min.js"></script>
<script src="report3_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="report3_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="report3_files/libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="report3_files/libs/quarto-html/popper.min.js"></script>
<script src="report3_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="report3_files/libs/quarto-html/anchor.min.js"></script>
<link href="report3_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="report3_files/libs/quarto-html/quarto-syntax-highlighting-dc55a5b9e770e841cd82e46aadbfb9b0.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="report3_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="report3_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="report3_files/libs/bootstrap/bootstrap-d6a003b94517c951b2d65075d42fb01b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="fullcontent quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">MATH-517: Assignment 3</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Loan Bianchi </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 4, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="theoretical-exercise-local-linear-regression-as-a-linear-smoother" class="level1">
<h1>1. Theoretical exercise: Local linear regression as a linear smoother</h1>
<p>We begin by recalling the definition of our estimator :</p>
<p><span class="math inline">\((\hat\beta_0(x), \hat\beta_1(x))
= \arg\min_{\beta_0,\beta_1 \in \mathbb{R}}
\sum_{i=1}^n \Big(Y_i - \beta_0 - \beta_1 (X_i - x)\Big)^2
K\left(\frac{X_i - x}{h}\right),\)</span></p>
<p>Let us actually solve 1 and 2 at the same time. We know from slide 14 of the lecture notes that we want to reach that <span class="math inline">\(\hat m(x) = \hat \beta_0 = \sum_{i=1}^n w_{ni}(x) Y_i,\)</span> for <span class="math inline">\(w_{ni}(x) = \frac{1}{nh}\frac{K(\frac{x - X_i}{h})(S_{n,2}(x) - (X_i - x)S_{n,1}(x))}{S_{n,0}(x)S_{n,2}(x) - S_{n,1}^2(x)}\)</span>, with <span class="math inline">\(S_{n,k}(x) = \frac{1}{nh}\sum_{i=1}^n (X_i - x)^k K\left(\frac{X_i - x}{h}\right), \quad k=0,1,2,.\)</span></p>
<p>Now the real challenge is to understand how we get to that formula. Firstly, let us denote <span class="math inline">\(f(\beta) = \sum_{i=1}^n \Big(Y_i - \beta_0 - \beta_1 (X_i - x)\Big)^2
K\left(\frac{X_i - x}{h}\right)\)</span>, with <span class="math inline">\(\beta = (\beta_0, \beta_1)\)</span>. Defining <span class="math inline">\(A\)</span> as the matrix with the <span class="math inline">\(i\)</span> th row being <span class="math inline">\(A_i = (1, X_i -x)\)</span> and <span class="math inline">\(D\)</span> the diagonal matrix with entries <span class="math inline">\(D_{ii} = K\left(\frac{X_i - x}{h}\right)\)</span>, we have <span class="math inline">\(f(\beta) = (Y - A\beta)^\top D (Y - A\beta)\)</span>. As a composition of a linear function with a quadratic function, <span class="math inline">\(f\)</span> is convex and we can differentiate and equate to 0 to find the minimizer.</p>
<p>We get the following system of equations :</p>
<p><span class="math inline">\(-2\sum_{i=1}^n \Big(Y_i - \hat\beta_0 - \hat\beta_1 (X_i - x)\Big)
K\left(\frac{X_i - x}{h}\right) = 0\)</span></p>
<p><span class="math inline">\(-(X_i - x)2\sum_{i=1}^n \Big(Y_i - \hat\beta_0 - \hat\beta_1 (X_i - x)\Big)
K\left(\frac{X_i - x}{h}\right) = 0\)</span></p>
<p>Or simplifying and rearranging :</p>
<p><span class="math inline">\(\sum_{i=1}^n K(\frac{X_i - x}{h})Y_i = \sum_{i=1}^n K (\frac{X_i - x}{h})(\hat\beta_0 + \hat\beta_1 (X_i - x))  \Leftrightarrow \frac{1}{nh}\sum_{i=1}^n K(\frac{X_i - x}{h})Y_i = S_{n,0}(x) \hat \beta_0 + S_{n,1}(x)\hat\beta_1\)</span></p>
<p><span class="math inline">\(\sum_{i=1}^n (X_i - x) K(\frac{X_i - x}{h})Y_i = \sum_{i=1}^n (X_i - x) K (\frac{X_i - x}{h})(\hat\beta_0 + \hat\beta_1 (X_i - x)) \Leftrightarrow \frac{1}{nh}\sum_{i=1}^n (X_i - x) K(\frac{X_i - x}{h})Y_i = S_{n,1}(x) \hat \beta_0 + S_{n,2}(x)\hat\beta_1\)</span></p>
<p>This can be rewritten as</p>
<p><span class="math inline">\(\begin{pmatrix} S_{0,n}(x) &amp; S_{1,n}(x) \\ S_{1,n}(x) &amp; S_{2,n}(x) \end{pmatrix}\)</span> <span class="math inline">\(\begin{pmatrix} \hat\beta_0 \\ \hat\beta_1 \end{pmatrix}\)</span> = <span class="math inline">\(\begin{pmatrix} \frac{1}{nh}\sum_{i=1}^n K(\frac{X_i - x}{h})Y_i \\ \frac{1}{nh}\sum_{i=1}^n (X_i - x) K(\frac{X_i - x}{h})Y_i \end{pmatrix}\)</span> .</p>
<p>As long as <span class="math inline">\(S_{n,0}(x)S_{n,2}(x) - S_{n,1}^2(x)\)</span> is non zero, we can use the inversion formula for a <span class="math inline">\(2 \times 2\)</span> matrix to get <span class="math inline">\(\begin{pmatrix} \hat\beta_0 \\ \hat\beta_1 \end{pmatrix} = \frac{1}{S_{n,0}(x)S_{n,2}(x) - S_{n,1}^2(x)}\begin{pmatrix} S_{2,n}(x) &amp; -S_{1,n}(x) \\ -S_{1,n}(x) &amp; S_{0,n}(x) \end{pmatrix}\begin{pmatrix} \frac{1}{nh}\sum_{i=1}^n K(\frac{X_i - x}{h})Y_i \\ \frac{1}{nh}\sum_{i=1}^n (X_i - x) K(\frac{X_i - x}{h})Y_i \end{pmatrix}\)</span></p>
<p>Hence, we get <span class="math inline">\(\hat \beta_0 = \sum_{i=1}^n w_{ni}(x) Y_i,\)</span> for <span class="math inline">\(w_{ni}(x) = \frac{1}{nh}\frac{K(\frac{x - X_i}{h})(S_{n,2}(x) - (X_i - x)S_{n,1}(x))}{S_{n,0}(x)S_{n,2}(x) - S_{n,1}^2(x)}\)</span>, which concludes 1 and 2.</p>
<p>Now, let us prove that these weights indeed sum up to 1.</p>
<p><span class="math inline">\(\sum_{i=1}^n K(\frac{x - X_i}{h})(S_{n,2}(x) - (X_i - x)S_{n,1}(x)) = nhS_{n.0}(x)S_{n,2}(x) - \sum_{i=1}^n K(\frac{x - X_i}{h})(X_i - x)S_{n,1}(x)\)</span></p>
<p><span class="math inline">\(= nhS_{n.0}(x)S_{n,2}(x) - S_{n,1}(x)\sum_{i=1}^n K(\frac{x - X_i}{h})(X_i - x) = nh(S_{n.0}(x)S_{n,2}(x) - S^2_{n,1}(x))\)</span>, which concludes the third point.</p>
</section>
<section id="practical-exercise-global-bandwidth-selection" class="level1">
<h1>2. Practical exercise: Global bandwidth selection</h1>
<p><strong>Important note</strong> : This analysis include an interactive shiny part. To make it work, it should be enough to open the .qmd file with Rstudio and simply click on “run document” (after having installed the shiny package if not already installed). In this provided pdf, we included static plots so that the user can see what it should look like, but it’s supposed to be interactive.</p>
<p>(I tried it on two computers to make sure that everything was fine and it worked for both so I sincerely hope it will work).</p>
<p>The aim of this simulation study is to analyse the behavior of the optimal bandwidth <span class="math inline">\(h_{opt}\)</span> under different conditions; with samples of different sizes <span class="math inline">\(n\)</span>, with different number of blocks <span class="math inline">\(N\)</span> used to estimates the quantities that we need, as well as with different distributions. In order to study this optimal bandwidth, we will make use of the beta distribution <span class="math inline">\(beta(\alpha, \beta)\)</span> which will reveal itself very useful for that simulation study, in the sense that varying parameters <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> leads to distributions that have density functions with various shapes.</p>
<p>This simulation was constructed in a way that allows the reader to capture a maximum of information out of the simplest possible plot. After considering many options, the one that seemed to be the most convincing was to make a shiny interactive plot, which simply shows a vertical line representing the value of <span class="math inline">\(h\)</span> with <span class="math inline">\(h_{opt}\)</span> evolving on it when varying the parameters. The reason for this quite surprising choice of a single line with a point is to make the reader focus on what really matters in that study and not get lost in many other values which can be relevant for other purposes but not for this study. Nonetheless, we decided to include the estimated <span class="math inline">\(\hat \sigma^2\)</span> next to the point, so that we can follow how the variance is estimated for the values of the parameters. It is also a way to be sure that our variance is well-estimated and that our value of <span class="math inline">\(h_{opt}\)</span> is coherent.</p>
<p>This simulation study will have two parts: the first one will be meant to study how our bandwidth behaves when we vary <span class="math inline">\(\alpha\)</span>, <span class="math inline">\(\beta\)</span>, and <span class="math inline">\(n\)</span>, but we “fix” <span class="math inline">\(N\)</span> to be optimal according to the formula given in the assignment task, i.e the <span class="math inline">\(N\)</span> minimizing</p>
<p><span class="math display">\[ C_p(N)=\text{RSS}(N) / \lbrace \text{RSS} (N_{\max }) / (n-5 N_{\max })\rbrace -(n-10 N), \]</span></p>
<p>where</p>
<p><span class="math display">\[\text{RSS}(N) =  \sum_{i=1}^n \sum_{j=1}^N \lbrace Y_i - \hat{m}\_j(X_i) \rbrace^2 \mathbb{1}_{X_i \in \mathcal{X}_j}\]</span></p>
<p>and <span class="math inline">\(N_{\max}= \max \lbrace \min (\lfloor n / 20\rfloor, 5 ), 1\rbrace\)</span>.</p>
<p>This first part is thought so that we can understand how these varying parameters impact the optimal bandwidth, knowing that we have a “good” <span class="math inline">\(N\)</span>. Here, I say “good” because the paper mentioned (<a href="https://sites.stat.washington.edu/courses/stat527/s13/readings/Ruppert_etal_JASA_1995.pdf">Ruppert et al.&nbsp;(1995)</a>) tells us that <span class="math inline">\(N &gt; 5\)</span> can also be taken into consideration when we have a regression function <span class="math inline">\(m\)</span> with many oscillations, which should be the case in our set-ups when <span class="math inline">\(x\)</span> is small… Now, for the simplicity of this study, we assume in the first part that <span class="math inline">\(N\leq 5\)</span>.</p>
<p>In the second part of this study, we will still be able to make <span class="math inline">\(\alpha\)</span>, <span class="math inline">\(\beta\)</span>, and <span class="math inline">\(n\)</span> vary, but we can now also let <span class="math inline">\(N\)</span> vary (and allows <span class="math inline">\(N&gt;5\)</span>). It is meant to help us understand how the number of blocks in our estimation impacts the bandwidth for some fixed parameters <span class="math inline">\(\alpha\)</span>, <span class="math inline">\(\beta\)</span>, and <span class="math inline">\(n\)</span>. The idea is to fix these parameters (at values of the reader’s choice) and make <span class="math inline">\(N\)</span> vary to see how our point evolves along the line. We also thought that it could be interesting to show what the optimal <span class="math inline">\(N\)</span> is next to the point so that we can know how far from the optimal value we get when we vary <span class="math inline">\(N\)</span>. In this part, we also include <span class="math inline">\(\hat\theta_{22}\)</span> next to the point. The reason for that choice will be made clearer in the analysis below.</p>
<p>An important precision is that the simulation is made so that when we vary <span class="math inline">\(n\)</span>, we don’t have a new sample every time, but we add or remove observations from our previous sample. The idea behind this is to make it more relatable to real life, where we often have a fixed sample of observations, to which we can add some observations if we get new ones over time. The idea is then to study how the bandwidth evolves when we add those new observations.</p>
<p>Another precision is that if <span class="math inline">\(N\)</span> doesn’t divide the size of the sample, we distribute the remaining observations evenly among the blocks (so that each block gets at most one of these remaining observations)</p>
<section id="first-part-of-the-simulation---optimal-bandwidth-h_opt-for-different-values-of-alpha-beta-and-n-n-automatically-set-to-the-optimal-value" class="level2">
<h2 class="anchored" data-anchor-id="first-part-of-the-simulation---optimal-bandwidth-h_opt-for-different-values-of-alpha-beta-and-n-n-automatically-set-to-the-optimal-value">First part of the simulation - optimal bandwidth <span class="math inline">\(h_{opt}\)</span> for different values of <span class="math inline">\(\alpha\)</span>, <span class="math inline">\(\beta\)</span> and <span class="math inline">\(n\)</span> (<span class="math inline">\(N\)</span> automatically set to the optimal value)</h2>
<div class="cell">
<div class="cell-output-display">
<div class="form-group shiny-input-container">
<label class="control-label" id="n-label" for="n">Sample size n:</label>
<input class="js-range-slider" id="n" data-skin="shiny" data-min="100" data-max="20000" data-from="10000" data-step="100" data-grid="true" data-grid-num="9.95" data-grid-snap="false" data-prettify-separator="," data-prettify-enabled="true" data-keyboard="true" data-data-type="number">
</div>
</div>
<div class="cell-output-display">
<div class="form-group shiny-input-container">
<label class="control-label" id="alpha-label" for="alpha">Parameter of the beta density alpha:</label>
<input class="js-range-slider" id="alpha" data-skin="shiny" data-min="0.5" data-max="5" data-from="2.5" data-step="0.5" data-grid="true" data-grid-num="9" data-grid-snap="false" data-prettify-separator="," data-prettify-enabled="true" data-keyboard="true" data-data-type="number">
</div>
</div>
<div class="cell-output-display">
<div class="form-group shiny-input-container">
<label class="control-label" id="beta-label" for="beta">Parameter of the beta density beta:</label>
<input class="js-range-slider" id="beta" data-skin="shiny" data-min="0.5" data-max="5" data-from="2.5" data-step="0.5" data-grid="true" data-grid-num="9" data-grid-snap="false" data-prettify-separator="," data-prettify-enabled="true" data-keyboard="true" data-data-type="number">
</div>
</div>
<div class="cell-output-display">
<div class="shiny-plot-output html-fill-item" id="distPlot" style="width:100%;height:400px;"></div>
</div>
</div>
<p>For the first part, we can see that if we fix <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span>, our <span class="math inline">\(h_{opt}\)</span> decreases when we make <span class="math inline">\(n\)</span> grow. This makes sense as the more observations we have, the more points we have close to one another. We can thus make <span class="math inline">\(h\)</span> smaller so that our kernel gives more importance to points close to x, as there should be plenty of them. On the contrary, if we have less observations, we might have more variance and giving a lot of importance only to very close points might lead to a dangerous game as there might not be many of them.</p>
<p>Now, let us fix <span class="math inline">\(n\)</span> (say, at 10’000) and observe the behavior of <span class="math inline">\(h_{opt}\)</span> when we make the density distribution of <span class="math inline">\(X\)</span> vary.</p>
<p>If we fix <span class="math inline">\(\alpha = 0.5\)</span> and make <span class="math inline">\(\beta\)</span> vary, we see that the bigger the <span class="math inline">\(\beta\)</span>, the smaller the <span class="math inline">\(h_{opt}\)</span>. This is because when <span class="math inline">\(\beta\)</span> is big compared to <span class="math inline">\(\alpha\)</span>, the <span class="math inline">\(beta\)</span> distribution is skewed near 0. Hence, as all the observations are (for most of them) concentrated in a small interval, we need smaller <span class="math inline">\(h\)</span> to captures the importance of all points close to each other, especially as our <span class="math inline">\(m\)</span> function oscillates very quickly for <span class="math inline">\(x\)</span> near 0. Interestingly, we see that when we set <span class="math inline">\(\alpha = \beta = 0.5\)</span>, we get a high <span class="math inline">\(h_{opt}\)</span>. A theory for this is that as our <span class="math inline">\(X_i\)</span>s are concentrated both near 0 and near 1, our <span class="math inline">\(m\)</span> function oscillates very quickly for <span class="math inline">\(x\)</span> near 0 but less quickly near 1, do we kind of need to have a higher <span class="math inline">\(h\)</span> to estimate our function near <span class="math inline">\(1\)</span>, but that leads to a quite poor estimate, which we can see in the quite bad estimation for the variance.</p>
<p>If we fix <span class="math inline">\(\beta = 0.5\)</span> and make <span class="math inline">\(\alpha\)</span> vary, we see that the bigger the <span class="math inline">\(\alpha\)</span>, the bigger the <span class="math inline">\(h_{opt}\)</span>. This makes sense as the more <span class="math inline">\(X_i\)</span>s there are near one, the less oscillations of our function <span class="math inline">\(m\)</span> will intervene and we will need to give importance to <span class="math inline">\(X_i\)</span>s a bit further from our <span class="math inline">\(x\)</span> to understand these “slow” oscillations.</p>
<p>If we fix <span class="math inline">\(\alpha = \beta = 2.5\)</span>, we get an intermediate value, which again makes sense as most of our <span class="math inline">\(X_i\)</span>s with be near 0.5 and is thus in-between the two extremes mentioned earlier.</p>
</section>
<section id="second-part-of-the-simulation---optimal-bandwidth-h_opt-for-different-values-of-alpha-beta-n-and-n" class="level2">
<h2 class="anchored" data-anchor-id="second-part-of-the-simulation---optimal-bandwidth-h_opt-for-different-values-of-alpha-beta-n-and-n">Second part of the simulation - optimal bandwidth <span class="math inline">\(h_{opt}\)</span> for different values of <span class="math inline">\(\alpha\)</span>, <span class="math inline">\(\beta\)</span>, <span class="math inline">\(n\)</span> and <span class="math inline">\(N\)</span></h2>
<div class="cell">
<div class="cell-output-display">
<div class="form-group shiny-input-container">
<label class="control-label" id="n2-label" for="n2">Sample size n:</label>
<input class="js-range-slider" id="n2" data-skin="shiny" data-min="1000" data-max="20000" data-from="10000" data-step="100" data-grid="true" data-grid-num="10" data-grid-snap="false" data-prettify-separator="," data-prettify-enabled="true" data-keyboard="true" data-data-type="number">
</div>
</div>
<div class="cell-output-display">
<div class="form-group shiny-input-container">
<label class="control-label" id="N-label" for="N">Number of blocks N:</label>
<input class="js-range-slider" id="N" data-skin="shiny" data-min="1" data-max="30" data-from="4" data-step="1" data-grid="true" data-grid-num="9.66666666666667" data-grid-snap="false" data-prettify-separator="," data-prettify-enabled="true" data-keyboard="true" data-data-type="number">
</div>
</div>
<div class="cell-output-display">
<div class="form-group shiny-input-container">
<label class="control-label" id="alpha2-label" for="alpha2">Parameter of the beta density alpha:</label>
<input class="js-range-slider" id="alpha2" data-skin="shiny" data-min="0.5" data-max="5" data-from="2.5" data-step="0.5" data-grid="true" data-grid-num="9" data-grid-snap="false" data-prettify-separator="," data-prettify-enabled="true" data-keyboard="true" data-data-type="number">
</div>
</div>
<div class="cell-output-display">
<div class="form-group shiny-input-container">
<label class="control-label" id="beta2-label" for="beta2">Parameter of the beta density beta:</label>
<input class="js-range-slider" id="beta2" data-skin="shiny" data-min="0.5" data-max="5" data-from="2.5" data-step="0.5" data-grid="true" data-grid-num="9" data-grid-snap="false" data-prettify-separator="," data-prettify-enabled="true" data-keyboard="true" data-data-type="number">
</div>
</div>
<div class="cell-output-display">
<div class="shiny-plot-output html-fill-item" id="distPlot2" style="width:100%;height:400px;"></div>
</div>
</div>
<p>For the second part, we see that no matter what value of the parameters <span class="math inline">\(n\)</span>, <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> we choose, we get that the bigger the number of blocks, the smaller the <span class="math inline">\(h_{opt}\)</span>. This could be explained by the fact that if we have a lot of blocks, our <span class="math inline">\(\hat \theta_{22}\)</span> will be bigger. Indeed, splitting into a lot of blocks with induce the fact that the linear regressions will be only on small parts of the sinus oscillations, making the curvature of the estimate bigger compared to if the regression were made over a lot of oscillations. A bigger <span class="math inline">\(\hat\theta_{22}\)</span> leads in turn to a smaller <span class="math inline">\(h_{opt}\)</span> if we simply look at the formula for computing <span class="math inline">\(h_{opt}\)</span>.</p>
<p>
<script type="application/shiny-prerendered" data-context="server-start">

#-----------------------------------------------------


#function that takes a sample (X, Y) and split it into N blocks. If N doesn't divide the size of the sample, we distribute the remaining observations among all blocks (so that each block gets at most one of this remaining observations)

split_into_blocks <- function(sample, N){
  
  n <- nrow(sample)
  general_size <- floor(n/N)
  
  updated_sizes <- c(rep(general_size + 1, n%%N), rep(general_size, N - n%%N))
  
  block_assignment <- rep(1:length(updated_sizes), times = updated_sizes)
  
  sample_split <- split(sample, block_assignment)
  
  return(sample_split)
  
}

#-----------------------------------------------------

#function that takes a splitted sample and returns estimated functions for m(x) and m''(x)

m_ests <- function(sample_split){
  
  est_functions <- lapply(sample_split, function(block) {
    
    regression_model <- lm(y ~ x + I(x^2) + I(x^3) + I(x^4), data = block)
    coefs <- coef(regression_model)
    
    list(
    m_hat = function(x){
      coefs[1] + coefs[2]*x + coefs[3]*x^2 + coefs[4]*x^3 + coefs[5]*x^4
    }, m_hat_prime_prime = function(x){
      2*coefs[3] + 6*coefs[4]*x + 12*coefs[5]*x^2
    })
  })
  return(est_functions)
}

#-----------------------------------------------------

#function that computes RSS(N) for a given sample and a given N

RSS <- function(sample, N){
  
  n <- nrow(sample)
  sample_split <- split_into_blocks(sample, N)
  
  m_hats <- lapply(m_ests(sample_split), function(both_m) both_m$m_hat)
  
  numerator <- 0 
  
  for (j in 1 : N){
    X_j <- sample_split[[j]]$x
    Y_j <- sample_split[[j]]$y
    
    m_hat_j <-m_hats[[j]]
    
    numerator <- numerator + sum((Y_j - m_hat_j(X_j))^2)
  }
  return(numerator)
  
}

#-----------------------------------------------------

#function which returns the estimated sigma^2 for a given sample and a given N

sigma2_est <- function(sample, N){
  
  n <- nrow(sample)
  
  sigma2_hat <- (1/(n - 5 * N)) * RSS(sample,N)
  
  return(sigma2_hat)
  
}

#-----------------------------------------------------

#function which returns the estimated theta_22 for a given sample and a given N

theta22_est <- function(sample, N){
  n <- nrow(sample)
  sample_split <- split_into_blocks(sample, N)
  
  m_hats_prime_prime <- lapply(m_ests(sample_split), function(both_m) both_m$m_hat_prime_prime)
  
  numerator <- 0 
  
  for (j in 1 : N){
    X_j <- sample_split[[j]]$x
    
    m_hat_j_prime_prime <-m_hats_prime_prime[[j]]
    
    numerator <- numerator + sum((m_hat_j_prime_prime(X_j))^2)
  }
  
  
  theta22_hat <- (1/n) * numerator
  
  return(theta22_hat)
  
}

#-----------------------------------------------------

#function that returns the optimal bandwidth h_AMISE for a given sample and a given N

h_AMISE_est <- function (sample, N){
   n <- nrow(sample)
  h_AMISE <- n^(-1/5)* ((((35 * sigma2_est(sample, N))/theta22_est(sample, N)))^(1/5))
  
  return (h_AMISE)
  
}





</script>
 
<script type="application/shiny-prerendered" data-context="server">


output$distPlot <- renderPlot({
  
  set.seed(700)
  
#genrating a full sample of 20000 observations and selecting the first n of them (n being the user's choice)
  
  full_X <- rbeta(20000, input$alpha, input$beta)
  
  full_epsilon <- rnorm(20000, 0, 1)
    
  m <- function(x){
    sin(1/(x/3 + 0.1))
  }
  
  X <- full_X[1:input$n]
  
  full_Y <- m(full_X) + full_epsilon
  
  Y <- full_Y[1:input$n]
  
  sample <- data.frame(x = X, y = Y)
  
  #computing the optimal N (N_opt)
  
  C_p <- function(sample, N){
    
    n <- nrow(sample)
    
    N_max <- max(min(floor(n / 20), 5), 1)  
    
    C_p_N <- (RSS(sample, N)/(RSS(sample, N_max)/(n - 5 * N_max))) - (n - 10 * N)
    
    return(C_p_N)
    
  }
  
  N_max <- max(min(floor(input$n / 20), 5), 1) 
  
  Ns <- 1:N_max
  
  costs <- sapply(Ns, function(N) C_p(sample, N))

  N_opt <- Ns[which.min(costs)]
  
  
  #computing the optimal bandwitdth h and the estimated sigma^2
  
  y <- h_AMISE_est(sample, N_opt)
    
  sigma2_hat <- sigma2_est(sample, N_opt)
  
  #plotting
  
  y_min <- 1/100000
  y_max <- 0.3
  
  op <- par(mar = c(5, 15, 4, 35)) 
  plot(1, y, type = "n", xlab = "", ylab = "Bandwidth h", 
       xaxt = "n", yaxt = "n", xlim = c(0,1), ylim = c(y_min, y_max),
       bty = "n")  
  par(op)

  segments(x0 = 0.5, y0 = y_min, x1 = 0.5, y1 = y_max, lwd = 2, col = "black")
  

  points(0.5, y, col = "red", pch = 19, cex = 2)
  
  
  text(0.55, y, labels = paste0("h_opt = ", round(y, 5), "    /    N_opt = ", N_opt, "    /    Sigma2_hat = ", round(sigma2_hat,3)), pos = 4, col = "black")
  
})

</script>
 
<script type="application/shiny-prerendered" data-context="server">
output$distPlot2 <- renderPlot({
  
  set.seed(700)
  
  #genrating a full sample of 20000 observations and selecting the first n of them (n being the user's choice)
  
  full_X <- rbeta(20000, input$alpha2, input$beta2)
  
  full_epsilon <- rnorm(20000, 0, 1)
    
  m <- function(x){
    sin(1/(x/3 + 0.1))
  }
  
  X <- full_X[1:input$n2]
  
  full_Y <- m(full_X) + full_epsilon
  
  Y <- full_Y[1:input$n2]
  
  sample <- data.frame(x = X, y = Y)
  
  #computing the optimal bandwitdth h, the estimated sigma^2 and the estimated theta_22
  
  y <- h_AMISE_est(sample, input$N)
    
  sigma2_hat <- sigma2_est(sample, input$N)
  theta22_hat <- theta22_est(sample, input$N)

  #plotting
  
  y_min <- 1/100000
  y_max <- 0.3
  
  op <- par(mar = c(5, 15, 4, 35)) 
  plot(1, y, type = "n", xlab = "", ylab = "Bandwidth h", 
       xaxt = "n", yaxt = "n", xlim = c(0,1), ylim = c(y_min, y_max),
       bty = "n")  
  par(op)

  segments(x0 = 0.5, y0 = y_min, x1 = 0.5, y1 = y_max, lwd = 2, col = "black")
  

  points(0.5, y, col = "red", pch = 19, cex = 2)
  
  
  text(0.55, y, labels = paste0("h_opt = ", round(y, 5), "    /    Sigma2_hat = ", round(sigma2_hat,3), "    /    Theta22_hat = ", round(theta22_hat,1) ), pos = 4, col = "black")
  
})
</script>
 
<script type="application/shiny-prerendered" data-context="server-extras">
ojs_define <- function(..., .session = shiny::getDefaultReactiveDomain()) {
  quos <- rlang::enquos(...)
  vars <- rlang::list2(...)
  nm <- names(vars)
  if (is.null(nm)) {
    nm <- rep_len("", length(vars))
  }
  mapply(
    function(q, nm, val) {
      # Infer name, if possible
      if (nm == "") {
        tryCatch(
          {
            nm <- rlang::as_name(q)
          },
          error = function(e) {
            code <- paste(collapse = "\n", deparse(rlang::f_rhs(q)))
            stop(
              "ojs_define() could not create a name for the argument: ",
              code
            )
          }
        )
      }
      .session$output[[nm]] <- val
      outputOptions(.session$output, nm, suspendWhenHidden = FALSE)
      .session$sendCustomMessage("ojs-export", list(name = nm))
      NULL
    },
    quos,
    nm,
    vars,
    SIMPLIFY = FALSE,
    USE.NAMES = FALSE
  )
  invisible()
}
</script>
</p>
<!--html_preserve-->
<script type="application/shiny-prerendered" data-context="dependencies">
{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["ionrangeslider-javascript"]},{"type":"character","attributes":{},"value":["2.3.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["www/shared/ionrangeslider"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["js/ion.rangeSlider.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["shiny"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["1.11.1"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["strftime"]},{"type":"character","attributes":{},"value":["0.9.2"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["www/shared/strftime"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["strftime-min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["shiny"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["1.11.1"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["ionrangeslider-css"]},{"type":"character","attributes":{},"value":["2.3.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["www/shared/ionrangeslider"]}]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["css/ion.rangeSlider.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["shiny"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["1.11.1"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["ionrangeslider-javascript"]},{"type":"character","attributes":{},"value":["2.3.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["www/shared/ionrangeslider"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["js/ion.rangeSlider.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["shiny"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["1.11.1"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["strftime"]},{"type":"character","attributes":{},"value":["0.9.2"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["www/shared/strftime"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["strftime-min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["shiny"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["1.11.1"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["ionrangeslider-css"]},{"type":"character","attributes":{},"value":["2.3.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["www/shared/ionrangeslider"]}]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["css/ion.rangeSlider.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["shiny"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["1.11.1"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["ionrangeslider-javascript"]},{"type":"character","attributes":{},"value":["2.3.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["www/shared/ionrangeslider"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["js/ion.rangeSlider.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["shiny"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["1.11.1"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["strftime"]},{"type":"character","attributes":{},"value":["0.9.2"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["www/shared/strftime"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["strftime-min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["shiny"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["1.11.1"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["ionrangeslider-css"]},{"type":"character","attributes":{},"value":["2.3.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["www/shared/ionrangeslider"]}]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["css/ion.rangeSlider.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["shiny"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["1.11.1"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["htmltools-fill"]},{"type":"character","attributes":{},"value":["0.5.8.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["fill"]}]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["fill.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["htmltools"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.5.8.1"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["ionrangeslider-javascript"]},{"type":"character","attributes":{},"value":["2.3.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["www/shared/ionrangeslider"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["js/ion.rangeSlider.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["shiny"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["1.11.1"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["strftime"]},{"type":"character","attributes":{},"value":["0.9.2"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["www/shared/strftime"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["strftime-min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["shiny"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["1.11.1"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["ionrangeslider-css"]},{"type":"character","attributes":{},"value":["2.3.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["www/shared/ionrangeslider"]}]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["css/ion.rangeSlider.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["shiny"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["1.11.1"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["ionrangeslider-javascript"]},{"type":"character","attributes":{},"value":["2.3.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["www/shared/ionrangeslider"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["js/ion.rangeSlider.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["shiny"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["1.11.1"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["strftime"]},{"type":"character","attributes":{},"value":["0.9.2"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["www/shared/strftime"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["strftime-min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["shiny"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["1.11.1"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["ionrangeslider-css"]},{"type":"character","attributes":{},"value":["2.3.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["www/shared/ionrangeslider"]}]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["css/ion.rangeSlider.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["shiny"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["1.11.1"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["ionrangeslider-javascript"]},{"type":"character","attributes":{},"value":["2.3.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["www/shared/ionrangeslider"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["js/ion.rangeSlider.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["shiny"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["1.11.1"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["strftime"]},{"type":"character","attributes":{},"value":["0.9.2"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["www/shared/strftime"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["strftime-min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["shiny"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["1.11.1"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["ionrangeslider-css"]},{"type":"character","attributes":{},"value":["2.3.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["www/shared/ionrangeslider"]}]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["css/ion.rangeSlider.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["shiny"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["1.11.1"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["ionrangeslider-javascript"]},{"type":"character","attributes":{},"value":["2.3.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["www/shared/ionrangeslider"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["js/ion.rangeSlider.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["shiny"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["1.11.1"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["strftime"]},{"type":"character","attributes":{},"value":["0.9.2"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["www/shared/strftime"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["strftime-min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["shiny"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["1.11.1"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["ionrangeslider-css"]},{"type":"character","attributes":{},"value":["2.3.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["www/shared/ionrangeslider"]}]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["css/ion.rangeSlider.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["shiny"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["1.11.1"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["htmltools-fill"]},{"type":"character","attributes":{},"value":["0.5.8.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["fill"]}]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["fill.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["htmltools"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.5.8.1"]}]}]}
</script>
<!--/html_preserve-->
<!--html_preserve-->
<script type="application/shiny-prerendered" data-context="execution_dependencies">
{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["packages"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["packages","version"]},"class":{"type":"character","attributes":{},"value":["data.frame"]},"row.names":{"type":"integer","attributes":{},"value":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35]}},"value":[{"type":"character","attributes":{},"value":["base","bslib","cachem","cli","compiler","datasets","digest","evaluate","fastmap","graphics","grDevices","htmltools","httpuv","jquerylib","jsonlite","knitr","later","lifecycle","magrittr","memoise","methods","mime","promises","R6","Rcpp","rlang","rmarkdown","sass","shiny","stats","tools","utils","xfun","xtable","yaml"]},{"type":"character","attributes":{},"value":["4.5.1","0.9.0","1.1.0","3.6.5","4.5.1","4.5.1","0.6.37","1.0.5","1.2.0","4.5.1","4.5.1","0.5.8.1","1.6.16","0.1.4","2.0.0","1.50","1.4.4","1.0.4","2.0.3","2.0.1","4.5.1","0.13","1.3.3","2.6.1","1.1.0","1.1.6","2.29","0.4.10","1.11.1","4.5.1","4.5.1","4.5.1","0.53","1.8-4","2.3.10"]}]}]}
</script>
<!--/html_preserve-->
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>